# ylab-transactions

Пример API для системы переводов. Список использованных технологий:
* python 3.8
* ayncio
* aiohttp + gunicron
* PostgreSQL в качестве бд и asyncpg в качестве драйвера;
* JSON Schema - для валидации запросов и генерации человекопонятных ошибок;
* JWT - для генерации токенов;
* bcrypt - для хеширвоания паролей;
* docker-compose - для запуска всего этого безобразия :)

## Настройка и запуск сервера

1. [Настройка API](#настройка-API)
1. [Запуск API](#запуск-API)
1. [Использование API:](#использование-API)
    * [Авторизация](#Авторизация)
    * [Добавление пользователя](#Добавление-пользователя)
    * [Перевод средств](#Перевод-средств)
    * [Список операций по счёту](#Список-операций-по-счёту)

### Настройка API

Перед запуском API внесите следующие изменения в файл [docker-compose.yml](docker-compose.yml):

* `DB_USER` - имя пользователя PostgreSQL. Должно совпадать с `POSTGRES_USER`;
* `DB_PASSWORD` - пароль пользователя PostgreSQL. Должен совпадать с `POSTGRES_PASSWORD`;
* `DB_NAME` - название базы данных. Должно совпадать с `POSTGRES_DB`;
* `USER_EMAIL` - email начального польователя;
* `USER_PASSWORD` - пароль начального пользователя;
* `USER_BALANCE` - баланс начального пользователя;
* `USER_CURRENCY` - валюта начального пользователя. Должно быть значение из списка: `USD`, `EUR`, `GBP`, `RUB`, `BTC`;
* `SECRET_KEY` - ключ для генерации токенов;
* `CURRENCY_UPDATE_DELAY` - время в минутах между обновлениями курса валют

### Запуск API

Для запуска выполните следующую команду в папке с проектом: `docker-compose up -d`.

### Использование API

Базовый URL: `127.0.0.1:80`. Все запросы делаются методом `POST`.

#### Авторизация

Пример запроса:

```json
{
    "request": {
        "auth": {
            "email": "root@localhost",
            "password": "1234"
        }
    },
    "token": ""
}
```

Поле `token` должно быть пустым. При успешной авторизации сервер пришёл токен, который нужно отправлять во всех следующих запросах. Токен истекает каждые 10 минут.

#### Добавление пользователя

Пример запроса:

```json
{
    "request": {
        "add_user": {
            "balance": 1234.56,
            "currency": "RUB",
            "email": "user@host",
            "password": "12345"
        }
    },
    "token": "bla-bla"
}
```

#### Перевод средств

Пример запроса:

```json
{
    "request": {
        "make_transaction": {
            "email": "user@host",
            "amount": 1
        }
    },
    "token": "bla-bla"
}
```

`email` - email получателя.

#### Список операций по счёту

Пример запроса:

```json
{
    "request": {
        "get_transactions_list": {
            "limit": 10,
            "skip": 20
        }
    },
    "token": "bla-bla"
}
```

`limit` - отдать не более N записей;  
`skip` - пропустить первые N записей.
